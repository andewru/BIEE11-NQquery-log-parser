Директория для downloaded-files
===============================

Данная директория хранит nqquery.log файлы.

Общий процесс выглядит следующим образом:

- с удаленного сервера BI по SSH в эту директорию при запуске по расписанию скрипта download-ssh.php загружаются nqquery.log файлы и им присваивается имена по маске: 1591321629-nqquery.log - как unixtimestamp-filename, где unixtimestamp это временная метка последней модификации файла на удаленном сервере и filename это имя файла на удаленном сервере.
- эту директорию по расписанию сканирует скрипт parse.php, выполняя парсинг файлов по маске unixtimestamp-filename и загрузку информации из низ в базу данных. После успешного парсинга файла скрипт переименовывает файл добавлением ему префикса done-, что бы уже исключить его выбор при следующем запуске парсера.

Именование файлов
-----------------

Файлы именуются по следующей маске:

- 1591321629-nqquery.log - как unixtimestamp-filename, где unixtimestamp это временная метка последней модификации файла на удаленном сервере и filename это имя файла на удаленном сервере. Такие имена имеют файлы скачанные с сервера BI, но еще не обработанные парсером и не загруженные в базу. Парсер, при чтении файлов этой директории работает только с файлами имеющими такую маску названия, файлы с другой маской названия игнорируются парсером.
- done-1591321629-nqquery.log - такие имена имеют файлы уже обработанные парсером и загруженные в базу данных. Парсер при запуске начинает перебирать по очереди все файлы с именем вида unixtimestamp-filename и выполняет для каждого парсинг и загрузку данных в базу данных и только после успеха этих операций для каждого файла, парсер выполняет переименовывание файла добавляя ему префикс done- и, тем самым, такие файлы исключаться из обработки при следующих стартах скрипта парсера.





